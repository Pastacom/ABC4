# ИДЗ №4
*Шиндяпкин Илья Дмитриевич БПИ-219*
## Задание
### Вариант №11
***
Работа реализована на 8 баллов.
## Условие
В больнице два дежурных врача принимают пациентов, выслушивают их жалобы и отправляют или к стоматологу, или к хирургу, или к терапевту. Стоматолог, хирург и терапевт лечат пациентов. Каждый врач может принять только одного пациента за раз. Пациенты стоят в очереди к врачам и никогда их не покидают. Создать многопоточное приложение, моделирующее рабочий день клиники.
***
## Файлы
Код представлен в файле abc.cpp на языке С++, есть исполняемый файл executable, а также входной файл для чтения input.txt, выходной файл для записи output.txt и папка tests, в которой есть 5 тестов с входными и выходными данными, демонстрирующие примеры работы программы.
***
## Входные данные
Единственным входным параметром является количество пациентов, которые придут в больницу. Однако генерация с различными параметрами позволяет полностью покрыть разнообразие случаев, которые могут произойти при работе потоков. 
Количество пациентов может быть в диапазоне от 1 до 100. 

Примеры тестовых данных не будут приведены в отчете, поскольку они очень объемны. Примеры работы можно найти в вышеупомянутых тестовых файлах.
***
Реализован ввод данных из консоли:

    ./executable
    Enter number of patients:3
Реализован ввод данных через командную строку:
 

    ./executable 3
Реализован ввод и вывод данных через файлы:
 

    ./executable input.txt output.txt
Реализована генерация количества пациентов и вывод в файл:

    ./executable -g output.txt
***
После ввода количества пациентов, каждый пациент генерируется со случайными параметрами. Для него генерируется имя, фамилия, тип болезни и стадия болезни.

Стадия болезни пациента  может быть от 1 до 10, влияет на потраченное на пациента время. 
Для каждого врача определенно максимальное время потраченное на пациента. Однако итоговое время обслуживания определяется по формуле:
[Предельное время работы врача * тяжесть болезни пациента / 10].

Тип болезни определяет к какому врачу обратится пациент. Переменная принимает значение от 1 до 3, где 1 - дантист, 2 - хирург, 3 - терапевт.

Предельное время работы врача:

Дежурный врач - 5с

Дантист - 20с

Хирург - 15с

Терапевт - 12с
***
## Модель параллельных вычислений
Условие задачи больше всего подходит под модель "Производители и потребители". Поскольку у нас имеется 5 потоков, а именно: 2 потока эмулирующие работу дежурного врача на регистрации пациентов, они обращаются к одной общей очереди к регистрации. После чего они перераспределяют пациентов в очереди к врачам. Еще 3 потока эмулируют работу врачей 3 специальностей, которые вызывают из своей очереди пациентов и проводят осмотр. То есть у нас есть некое подобие конвейера, где последовательно с пациентами работают сначала дежурные врачи, а потом специалисты.
 ***
 ## Сценарий, описывающий поведение объектов разрабатываемой программы

В начале работы программы мы считываем сгенерированные данные пациентов и ставим их в очередь на регистрацию. После чего свою работу начинают 4 сущности: дежурный врач, дантист, хирург и терапевт.

Два дежурных врача по порядку вызывают пациентов из очереди, после чего тратят необходимое на регистрацию время в зависимости от тяжести болезни пациента. Дежурные врачи работают, пока очередь на регистрацию не опустеет. 

После распределения пациент попадает в очередь к одному из специалистов, который так же вызывает пациентов по порядку их прихода. Далее тратит на них необходимое время для осмотра, которое так же варьируется от типа специалиста и тяжести болезни, после чего зовет следующего. Специалисты работают, пока больница не опустеет. Важно отметить, что у врача проверяется, что очередь не пуста, поскольку условие работы каждого врача обобщено с помощью количества пациентов по всей больнице.
***
## Обобщенный алгоритм
-   Класс Hospital является агрегатором для статических функций, которые выполняют потоки, а так же 4 типов класса HospitalQueue, которые имитируют работу очереди для определенного типа врача. Также в этом классе есть счетчик пациентов patientsAmount, оставшихся в больнице, для отслеживания конца работы врачей, а еще мьютекс decrementMutex для безопасного изменения значения этого счетчика.
-   Класс HospitalQueue выполняет всевозможные действия с очередью. В очередь могут добавляться новые пациенты, вызываться пациенты из очереди, при этом во время вызова поток засыпает на определенное время с помощью метода sleep(), симулируя работу с пациентом. Механизм подсчета времени сна уже был описан выше. При этом создается безопасность работы с очередью при помощи мьютексов, которая реализована с помощью std::queue. Все действия сопровождаются логами о действиях с пациентами, которые выводятся либо только в консоль, либо и в консоль, и в файл, что зависит от типа запуска программы. HospitalQueue также содержит в себе поле doctor, который определяет тип врача, который отвечает за очередь.
-   Класс Doctor является суперклассом для классов Dentist, Surgeon, Therapist, а также готовым классом с реализацией дежурного врача. Имеет поле timeOfReceipt_, которое определяет максимальное время обслуживания пациента и равняется 5с, метод toString(), возвращающий строковое представление врача, а также метод getReceiptTime(), который возвращает значение, затраченное на пациента по описанной выше формуле.
- Класс Dentist, переопределяет метод со строковым представлением врача, а также устанавливает предельное время обслуживания на 20с.
- Класс Surgeon, переопределяет метод со строковым представлением врача, а также устанавливает предельное время обслуживания на 15с.
- Класс Therapist, переопределяет метод со строковым представлением врача, а также устанавливает предельное время обслуживания на 12с.
-   Выполнение функций дежурных врачей будет происходить до опустения очереди регистрации. Выполнение функций других специалистов будет работать, пока больница не опустеет.

- В начале создается 2 потока, выполняющие функцию, предназначенную для дежурных врачей, и еще 3 потока, выполняющие функцию, предназначенную для специалистов. При этом для определения, с очередью какого специалиста необходимо работать, предается типизирующий параметр, определяющий какой тип очереди(врача), будет работать в этом потоке.
